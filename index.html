<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pesquisa de Satisfação Facilities</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; line-height: 1.6; }
        .pergunta-bloco { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .opcoes { display: flex; gap: 10px; margin-top: 5px; }
        label { font-weight: bold; display: block; }
        .justificativa-area { margin-top: 20px; display: none; }
        textarea { width: 100%; height: 80px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .nota-label { display: flex; flex-direction: column; align-items: center; font-weight: normal; font-size: 12px; }
    </style>
</head>
<body>

    <h2>Pesquisa de Satisfação - Facilities</h2>
    <form id="formPesquisa">
        <div id="containerPerguntas"></div>

        <div id="blocoJustificativa" class="justificativa-area">
            <label>Por favor, justifique sua avaliação negativa:*</label>
            <textarea id="justificativa" placeholder="Conte-nos o que podemos melhorar..."></textarea>
        </div>

        <br>
        <button type="submit" id="btnEnviar">Enviar Avaliação</button>
    </form>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxUcBOHz2Br_VGdc6slepinlW31sYIePTaAqM4WlOa3NgbLYbsQi3s1Qpwvt_uHmXs9eg/exec';

        const perguntas = [
            { titulo: "Avaliação Geral", texto: "Como você avalia a área de Facilities?", nome: "avaliacao_geral" },
            { titulo: "Ambiente", texto: "Os serviços contribuem para um ambiente produtivo?", nome: "ambiente" },
            { titulo: "Limpeza", texto: "Como avalia a limpeza dos ambientes?", nome: "limpeza" },
            { titulo: "Manutenção", texto: "Como avalia a manutenção predial?", nome: "manutencao" },
            { titulo: "Atendimento", texto: "A equipe é acessível e cordial?", nome: "atendimento" },
            { titulo: "Frota", texto: "Avaliação das solicitações de frota:", nome: "frota" },
            { titulo: "Viagens", texto: "Avaliação de passagens e hospedagens:", nome: "viagens" },
            { titulo: "Equipamentos", texto: "Controle de equipamentos (Celulares/Notebooks):", nome: "equipamentos" }
        ];

        const container = document.getElementById('containerPerguntas');

        // Renderiza as perguntas
        perguntas.forEach(p => {
            const div = document.createElement('div');
            div.className = 'pergunta-bloco';
            div.innerHTML = `
                <label>${p.titulo}</label>
                <small>${p.texto}</small>
                <div class="opcoes">
                    ${[1, 2, 3, 4, 5].map(nota => `
                        <label class="nota-label">
                            <input type="radio" name="${p.nome}" value="${nota}" required onclick="verificarNotas()">
                            ${nota}
                        </label>
                    `).join('')}
                </div>
            `;
            container.appendChild(div);
        });

        // Mostra justificativa se houver nota 1 ou 2
        function verificarNotas() {
            const formData = new FormData(document.getElementById('formPesquisa'));
            let temNotaBaixa = false;
            for (let value of formData.values()) {
                if (parseInt(value) <= 2) temNotaBaixa = true;
            }
            document.getElementById('blocoJustificativa').style.display = temNotaBaixa ? 'block' : 'none';
        }

        // Envio do formulário
        document.getElementById('formPesquisa').addEventListener('submit', e => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.innerText = "Enviando...";

            const formData = new FormData(e.target);
            const dados = Object.fromEntries(formData.entries());
            dados.justificativa = document.getElementById('justificativa').value;

            // Validação da Justificativa
            let temNotaBaixa = Object.values(dados).some(v => parseInt(v) <= 2);
            if (temNotaBaixa && dados.justificativa.trim().length < 5) {
                alert("Por favor, preencha a justificativa para as notas baixas.");
                btn.disabled = false;
                btn.innerText = "Enviar Avaliação";
                return;
            }

            fetch(scriptURL, { method: 'POST', body: JSON.stringify(dados)})
                .then(response => {
                    alert("Obrigado pela sua participação!");
                    e.target.reset();
                    document.getElementById('blocoJustificativa').style.display = 'none';
                })
                .catch(error => alert("Erro ao enviar! Tente novamente."))
                .finally(() => {
                    btn.disabled = false;
                    btn.innerText = "Enviar Avaliação";
                });
        });
    </script>
</body>
</html>
