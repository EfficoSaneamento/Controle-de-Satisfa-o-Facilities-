<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesquisa Facilities | Effico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .radio-card:checked + .radio-label {
            background-color: #2563eb; color: white; border-color: #2563eb; transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-slate-50 p-4">

    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
        <div class="bg-blue-600 p-6 text-white">
            <h1 class="text-xl font-bold">Avaliação de Serviços Facilities</h1>
            <p class="text-sm opacity-90">Sua nota ajuda a direcionar nossas melhorias.</p>
        </div>

        <form id="formPesquisa" class="p-6 space-y-6">
            <div id="containerPerguntas" class="space-y-6"></div>

            <div id="blocoJustificativa" class="hidden space-y-3 p-4 bg-orange-50 rounded-xl border border-orange-200">
                <label class="block text-orange-800 font-bold text-sm">
                    Justificativa Obrigatória *
                </label>
                <p class="text-xs text-orange-700">Identificamos uma nota baixa. Por favor, descreva o motivo:</p>
                <textarea id="justificativa" class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 outline-none text-sm" rows="3"></textarea>
            </div>

            <button type="submit" id="btnEnviar" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-all disabled:bg-slate-300">
                Finalizar Pesquisa
            </button>
        </form>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwExs94SQyLIkoILheIc7yCxWOG4ysnOCUwQl1q3v58mPFIP9cOEuwM49SgjaSMIiuQZg/exec';

        const perguntas = [
            { titulo: "Avaliação Geral", texto: "Satisfação geral com os serviços", nome: "avaliacao_geral" },
            { titulo: "Ambiente", texto: "Contribuição para produtividade", nome: "ambiente" },
            { titulo: "Limpeza", texto: "Qualidade e frequência da limpeza", nome: "limpeza" },
            { titulo: "Manutenção", texto: "Agilidade nos reparos prediais", nome: "manutencao" },
            { titulo: "Atendimento", texto: "Cordialidade da equipe", nome: "atendimento" },
            { titulo: "Frota", texto: "Locação e estado dos veículos", nome: "frota" },
            { titulo: "Viagens", texto: "Passagens e hospedagens", nome: "viagens" },
            { titulo: "Equipamentos", texto: "Entrega e controle de ativos", nome: "equipamentos" }
        ];

        // Renderização
        const container = document.getElementById('containerPerguntas');
        perguntas.forEach(p => {
            const div = document.createElement('div');
            div.innerHTML = `
                <div class="mb-2">
                    <span class="block font-bold text-slate-700">${p.titulo}</span>
                    <span class="text-xs text-slate-500">${p.texto}</span>
                </div>
                <div class="flex justify-between gap-2">
                    ${[1, 2, 3, 4, 5].map(n => `
                        <div class="flex-1">
                            <input type="radio" name="${p.nome}" id="${p.nome}_${n}" value="${n}" class="hidden radio-card" required onchange="verificarLógica()">
                            <label for="${p.nome}_${n}" class="radio-label flex items-center justify-center p-3 border-2 border-slate-200 rounded-lg cursor-pointer font-bold text-slate-600 hover:bg-slate-50 transition-all">${n}</label>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(div);
        });

        // Lógica de aparecer justificativa
        function verificarLógica() {
            const dados = new FormData(document.getElementById('formPesquisa'));
            let precisaJustificar = false;
            for (let v of dados.values()) {
                if (parseInt(v) <= 2) precisaJustificar = true;
            }
            
            const bloco = document.getElementById('blocoJustificativa');
            bloco.classList.toggle('hidden', !precisaJustificar);
        }

        // Validação no envio
        document.getElementById('formPesquisa').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnEnviar');
            const formData = new FormData(e.target);
            const dados = Object.fromEntries(formData.entries());
            const justificativa = document.getElementById('justificativa').value.trim();

            let temNotaBaixa = Object.values(dados).some(v => parseInt(v) <= 2);

            if (temNotaBaixa && justificativa.length < 5) {
                alert("⚠️ Atenção: Para notas 1 ou 2, a justificativa é obrigatória para que possamos melhorar.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Enviando dados...";
            dados.justificativa = justificativa;

            try {
                await fetch(scriptURL, { method: 'POST', body: JSON.stringify(dados) });
                alert("✅ Pesquisa enviada com sucesso!");
                window.location.reload();
            } catch (err) {
                alert("Erro ao conectar com o servidor.");
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
